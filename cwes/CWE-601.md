# Pattern: CWE-601 Open Redirect (Generic)

## What to look for
- Sources: attacker‑controlled URL/path/query fragments used to build a redirect Location header or HTTP 3xx response.
- Sinks: code that writes `Location:` or constructs 3xx responses.

## Red flags
- Redirects built from unvalidated user input, even after URL decoding.
- Lack of allowlist for hosts/paths, no scheme/domain checks, no relative‑only enforcement.

## High‑level procedure (IDA Pro MCP)
1) Find strings: `"Location:"`, `"HTTP/1.1 30"`, `"redirect"`.
2) Xref and decompile redirect builders; identify where the Location value comes from.
3) Walk back to dispatcher/handlers to see if user input influences the Location.

## Desired fix shape
- Enforce relative redirects or strict allowlist of domains/paths.
- Normalize/validate the target before emitting Location.

## Dynamic spot‑checks
- Try `?next=http://attacker/` or path parameters that are reflected into Location.

## Advanced fuzz strategy
- Targets: query params (`next`, `url`, `redirect`, `returnTo`), path segments, fragments.
- Payload families:
  - Absolute URLs: `http://attacker/`, `//attacker/` (scheme-relative), `\attacker\`
  - Mixed/encoded: `http:%2f%2fattacker/`, `/%5c/attacker/`, `%5c%5cattacker/`
  - Userinfo tricks: `http://attacker@trusted/`
  - CRLF/response splitting adjacency: `%0d%0aLocation:%20http://attacker/` (only in safe tests)
- Heuristics:
  - 3xx status with Location header controlled by input
  - Open redirect when Location points to untrusted host/scheme
  - Normalization quirks: double-decoding leading to external Location
- Mitigations to verify:
  - Enforce relative-only redirects or strict allowlists
  - Normalize/validate before emitting Location
